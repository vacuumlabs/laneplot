(function(f,m,u){"function"!==typeof Object.create&&(Object.create=function(a){function c(){}c.prototype=a;return new c});var p=function(){var a=this;this.svg={elem:null,wrapper:null,width:0,height:0,minValue:0,maxValue:0,scale:null,rectMargin:5,timelinesCount:1,xAxisHeight:20,eventOverflow:0,gradients:[],position:0,padding:5};this.timelines=[];this.viewport={width:0,milliseconds:0};this.labels={elem:null,width:0,height:0,laneHeight:0};this.errorCallback=null;this.init=function(c,b,d,e,g,f,h,k,n){0>= parseInt(f)&&this.errorMsg("ERR_BAD_HEIGHT",f);a.svg.elem=c;a.svg.wrapper=b;a.labels.elem=d;a.labels.laneCount=e;a.labels.width=g;a.labels.laneHeight=f;a.viewport.milliseconds=parseInt(h);k instanceof Array&&0!=k.length?a.timelines=k:a.timelines.push({resolution:Math.ceil(a.viewport.milliseconds),dateFormat:"MM-DD"});a.errorCallback=n};this.update=function(c,b){c&&b&&(a.svg.minValue=c,a.svg.maxValue=b,a.viewport.width=a.svg.wrapper.width(),a.svg.scale=d3.scale.linear().domain([0,a.viewport.milliseconds]).range([0, a.viewport.width]),a.svg.width=a.svg.scale(Math.abs(b-c)),a.svg.elem.attr("width",a.svg.width+a.svg.eventOverflow+a.svg.padding));a.labels.elem.css("width",a.labels.width);a.svg.wrapper.css("margin-left",a.labels.width);var d=a.svg.xAxisHeight*a.timelines.length;a.svg.height=a.labels.laneCount*parseInt(a.labels.laneHeight)+d;a.svg.elem.attr("height",a.svg.height);a.svg.elem.attr("transform","translate(4,0)")};this.generateGradient=function(c){var b="";a.svg.gradients.forEach(function(a){a.color0== c[0]&&a.color1==c[1]&&(b=a.id)});if(""!=b)return b;var b="gradient"+a.svg.gradients.length,d=a.svg.elem.append("svg:defs").append("svg:linearGradient").attr("id",b).attr("x1","100%").attr("y1","100%").attr("x2","100%").attr("y2","0%");d.append("svg:stop").attr("offset","0").attr("stop-color",c[0]);d.append("svg:stop").attr("offset","1").attr("stop-color",c[1]);a.svg.gradients.push({color0:c[0],color1:c[1],id:"#"+b});return"#"+b};this.progressPolygon=function(a,b,d,e,g,f){f?(a="M "+(a+g)+","+b+(" h "+ (d-2*g)),a+=" a "+g+","+g+" 0 0 1 "+g+","+g,a+=" v "+(e-2*g),a+=" a "+g+","+g+" 0 0 1 "+-g+","+g):(a="M "+(a+g)+","+b+(" h "+(d-2*g)),a+=" l "+g+","+e/2,a+=" l "+-g+","+e/2);a+=" h "+(2*g-d);a+=" a "+g+","+g+" 0 0 1 "+-g+","+-g;a+=" v "+(2*g-e);a+=" a "+g+","+g+" 0 0 1 "+g+","+-g;return a+=" z"};this.attachTooltip=function(c,b){var d={position:{my:"top center",at:"bottom center",adjust:{mouse:!1}},style:{},content:{text:""},events:{show:function(b,d){var l=Math.floor(f(c).offset().top)+parseInt(a.labels.laneHeight)- 2*a.svg.rectMargin;d.options.position.target=[d.mouse.pageX,l]}},show:{event:"click mouseenter",solo:!0},hide:{event:"unfocus mouseleave"}};if("string"===typeof b)d.content.text=b;else if("object"===typeof b)"string"===typeof b.content&&(d.content.text=b.content),"string"===typeof b.classes&&(d.style.classes=b.classes);else return!1;"undefined"===typeof jQuery.fn.qtip&&a.errorMsg("ERR_NO_PLUGIN",{name:"qtip"});f(c).qtip(d)};this.errorMsg=function(a,b){if("function"!==typeof this.errorCallback)return!1; [{code:"ERR_NO_DATA",message:"V konfigur\u00e1cii ch\u00fdba objekt data"},{code:"ERR_DATE_FMT",message:"Nepodarilo sa spracovat datum"},{code:"ERR_BAD_EVENT_TYPE",message:"Lane item nezodpoveda specifikacii ziadneho typu eventu alebo intervalu"},{code:"ERR_BAD_RANGE",message:"Nespravny rozsah datumov"},{code:"ERR_BAD_HEIGHT",message:"Hodnota laneHeight musi byt vacsia ako 0"},{code:"ERR_NO_PLUGIN",message:"Nepodarilo sa nacitat potrebne pluginy"},{code:"ERR_INTERVAL_COLLISION",message:"Intervaly v rovnakom riadku sa nemozu prekryvat"}].forEach(function(b){if(b.code== a)return jQuery.extend({},b),!1});this.errorCallback(a,jQuery.extend({},b))}},r={init:function(a,c){var b=this;b.elem=f(c);b.graphics=new p;b.options=f.extend(!0,{},f.fn.vacuumGantt.options,a);if("undefined"===typeof moment&&"function"==typeof b.options.onError)b.options.onError("ERR_NO_PLUGIN",{name:"momentjs"});if("undefined"===typeof d3&&"function"==typeof b.options.onError)b.options.onError("ERR_NO_PLUGIN",{name:"d3js"});b.options.data instanceof Array||b.graphics.errorMsg("ERR_NO_DATA",b.options.data); var d=f("<div/>",{"class":"leftCol"}),e=f("<div/>",{"class":"svgWrapper"}),g=f("<div/>",{"class":"rightCol",html:e});b.elem.addClass("vacuumGantt").append(g).append(d).append('<div class="clearfix"></div>');b.graphics.labels.elem=d;"function"===typeof b.options.onLaneClick&&b.elem.bind("click touchstart",function(a){var c=f(this).offset();a=Math.floor((a.pageY-c.top)/parseInt(b.options.settings.laneHeight));b.options.onLaneClick.call(this,b.options.data[a])});b.graphics.init(d3.select(e[0]).append("svg:svg"), e,d,b.options.data.length,b.options.settings.labelsWidth,b.options.settings.laneHeight,b.options.settings.viewport.width,b.options.settings.grid.timelines,b.options.onError);b.graphics.svg.elem.append("g").attr("class","yaxis");b.graphics.timelines.sort(function(a,b){return a.resolution>b.resolution?-1:a.resolution<b.resolution?1:0});var l=1;b.graphics.timelines.forEach(function(){b.graphics.svg.elem.append("g").attr("class","xaxis time"+l);l++});b.graphics.svg.elem.append("g").attr("class","items"); b.lanes=[];if(b.options.data instanceof Array){var h=0;b.options.data.forEach(function(a){var c=Object.create(q);c.init(b,a,h,b.graphics);c.render();b.lanes.push(c);h++})}d=b.options.settings;"string"===typeof d.boundaries.startDate&&""!=d.boundaries.startDate&&(d.boundaries.startDate=new Date(d.boundaries.startDate),!d.boundaries.startDate instanceof Date&&b.graphics.errorMsg("ERR_DATE_FMT",d.boundaries.startDate));"string"===typeof d.boundaries.endDate&&""!=d.boundaries.endDate&&(d.boundaries.endDate= new Date(d.boundaries.endDate),!d.boundaries.endDate instanceof Date&&b.graphics.errorMsg("ERR_DATE_FMT",d.boundaries.endDate));"string"===typeof d.viewport.position&&""!=d.viewport.position&&(d.viewport.position=new Date(d.viewport.position),!d.viewport.position instanceof Date&&b.graphics.errorMsg("ERR_DATE_FMT",d.viewport.position));d.boundaries.startDate instanceof Date||(d.boundaries.startDate=b.minDate);d.boundaries.endDate instanceof Date||(d.boundaries.endDate=b.maxDate);d.boundaries.startDate> d.boundaries.endDate&&b.graphics.errorMsg("ERR_BAD_RANGE",d.boundaries)},resize:function(){var a=this,c=a.options.settings;a.graphics.update(c.boundaries.startDate,c.boundaries.endDate);a.lanes.forEach(function(a){a.resize();a.items.forEach(function(a){a.resize()})});if(0<c.viewport.position)if(c.viewport.position<c.boundaries.startDate)a.graphics.svg.wrapper.scrollLeft(a.graphics.svg.scale(0));else{var b=Math.abs(c.boundaries.startDate-c.viewport.position);a.graphics.svg.wrapper.scrollLeft(a.graphics.svg.scale(b))}var d, e,g,f,h,k=1;a.graphics.timelines.forEach(function(b){d=5;isNaN(b.resolution)||(d=Math.abs(c.boundaries.startDate.getTime()-c.boundaries.endDate.getTime()),d=Math.floor(d/b.resolution));e=a.graphics.svg.elem.select(".xaxis.time"+k);g=[c.boundaries.startDate,c.boundaries.endDate];f=d3.time.scale().domain(g).range(g.map(d3.time.scale().domain(g).range([0,a.graphics.svg.width])));h=d3.svg.axis().scale(f).orient("bottom").tickSize(-a.graphics.svg.height).ticks(d).tickFormat(function(a){return moment(a).format(b.dateFormat)}); e.selectAll().remove();e.attr("transform","translate(0, "+(a.graphics.svg.height-a.graphics.svg.xAxisHeight*k)+")").call(h).selectAll("text").attr("y",6).attr("x",1).style("text-anchor","start");k!=a.graphics.timelines.length&&e.selectAll("line").attr("transform","translate(0, "+a.graphics.svg.xAxisHeight+")");d3.select(e.selectAll("g")[0].pop()).remove();k++});"string"===typeof c.grid.color&&""!=typeof c.grid.color&&(a.graphics.svg.elem.selectAll("text").style("fill",c.grid.color),a.graphics.svg.elem.selectAll("line, path").style("stroke", c.grid.color),a.graphics.svg.elem.selectAll(".yaxis path").style("stroke",c.grid.color))}},q={init:function(a,c,b,d){var e=this;e.graphics=d;e.index=b;e.data=f.extend({},f.fn.vacuumGantt.laneOptions,c);e.elem=f("<div/>",{"class":"lane-label",style:"line-height:"+e.graphics.labels.laneHeight+";height:"+e.graphics.labels.laneHeight});if("string"===typeof e.data.icon&&""!=e.data.icon){var g=f("<img/>",{"class":"lane-icon",style:"max-height:"+e.graphics.labels.laneHeight+";",src:e.data.icon,alt:"lane-icon"}); g.load(function(){e.elem.css("padding-left",parseInt(e.elem.css("padding-left"))+g.width()+2)});e.elem.append(g)}e.elem.append(e.data.description);e.data.items instanceof Array&&(e.items=[],e.data.items.forEach(function(b){var c=null;"string"===typeof b.date&&""!=b.date?c=Object.create(s):"string"===typeof b.startDate&&""!=b.startDate&&"string"===typeof b.endDate&&""!=b.endDate&&(c=Object.create(t));c.init(a,e.index,b,e.graphics);c.render();e.items.push(c)}),e.checkIntersections())},render:function(){this.graphics.labels.elem.append(this.elem); this.yaxis=this.graphics.svg.elem.select("g.yaxis").append("svg:path")},resize:function(){var a=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),c=[{x:0,y:(this.index+1)*parseInt(this.graphics.labels.laneHeight)},{x:this.graphics.svg.width,y:(this.index+1)*parseInt(this.graphics.labels.laneHeight)}];this.yaxis.attr("d",a(c))},checkIntersections:function(){for(var a=0;a<this.items.length;a++)for(var c=0;c<this.items.length;c++)"event"!=this.items[a].type&&"event"!= this.items[c].type&&a!=c&&(this.items[a].startDate>=this.items[c].startDate&&this.items[a].startDate<=this.items[c].endDate||this.items[a].endDate>=this.items[c].startDate&&this.items[a].endDate<=this.items[c].startDate)&&this.graphics.errorMsg("ERR_INTERVAL_COLLISION",{interval1:this.items[a].data,interval2:this.items[c].data})}},t={type:"interval",init:function(a,c,b,d){this.graphics=d;this.laneIndex=c;this.boundaries=a.options.settings.boundaries;this.data=f.extend({},f.fn.vacuumGantt.intervalOptions, b);"undefined"!=typeof this.data.startDate&&"undefined"!=typeof this.data.endDate||this.graphics.errorMsg("ERR_BAD_EVENT_TYPE",b);"string"===typeof this.data.startDate&&""!=this.data.startDate&&(this.startDate=new Date(this.data.startDate));"string"===typeof this.data.endDate&&""!=this.data.endDate&&(this.endDate=new Date(this.data.endDate));this.progressDate="string"===typeof this.data.progressDate&&""!=this.data.progressDate?new Date(this.data.progressDate):this.endDate instanceof Date?this.endDate: null;this.startDate instanceof Date||this.graphics.errorMsg("ERR_DATE_FMT",this.data.startDate);this.endDate instanceof Date||this.graphics.errorMsg("ERR_DATE_FMT",this.data.endDate);!this.data.progressDate||this.startDate instanceof Date||this.graphics.errorMsg("ERR_DATE_FMT",this.data.progressDate);this.minMaxDate(a,this.startDate,this.endDate)},render:function(){this.intervalGroup=this.graphics.svg.elem.select("g.items").append("g").attr("class","interval");var a=this.data.classes.join(" "),c= this.intervalGroup.append("svg:rect").attr("rx",5).attr("class",a+" unfinished");"string"===typeof this.data.unfinishedColor&&""!=this.data.unfinishedColor?c.attr("style","fill:"+this.data.unfinishedColor):this.data.unfinishedColor instanceof Array&&c.attr("style","fill:url("+this.graphics.generateGradient(this.data.unfinishedColor)+")");c=this.intervalGroup.append("path").attr("class",a+" progress");"string"===typeof this.data.progressColor&&""!=this.data.progressColor?c.attr("style","fill:"+this.data.progressColor): this.data.progressColor instanceof Array&&c.attr("style","fill:url("+this.graphics.generateGradient(this.data.progressColor)+")");this.intervalText=f("<div/>",{"class":"intervalText "+a,html:this.data.label});"string"===typeof this.data.icon&&""!=this.data.icon&&(a=f("<img />",{src:this.data.icon,"class":"intervalIcon"}),this.intervalText.prepend(a));this.graphics.attachTooltip(this.intervalText,this.data.tooltip);this.graphics.svg.wrapper.append(this.intervalText)},minMaxDate:function(a,c,b){if(null== a.minDate||a.minDate>c)a.minDate=c;if(null==a.maxDate||a.maxDate<b)a.maxDate=b},resize:function(){var a=this;a.startDate<a.boundaries.startDate&&(a.startDate=a.boundaries.startDate);var c=Math.abs(a.startDate-a.boundaries.startDate),b=parseInt(a.graphics.labels.laneHeight)*a.laneIndex+a.graphics.svg.rectMargin,d=Math.abs(a.progressDate-a.startDate),e=Math.abs(a.endDate-a.startDate),g=parseInt(a.graphics.labels.laneHeight)-2*a.graphics.svg.rectMargin,l=a.intervalGroup.select("path.progress"),h=a.intervalGroup.select("rect.unfinished"); (a.startDate>a.endDate||a.progressDate>a.endDate||a.progressDate<a.startDate)&&a.graphics.errorMsg("ERR_BAD_RANGE",a.data);c=a.graphics.svg.scale(c);d=a.graphics.svg.scale(d);e=a.graphics.svg.scale(e);h.attr("x",c).attr("y",b).attr("width",e).attr("height",g);h=0==Math.abs(a.progressDate-a.endDate)?!0:!1;l.attr("d",a.graphics.progressPolygon(c,b,d,g,5,h));a.intervalText.css("left",(c+2*a.graphics.svg.rectMargin).toFixed(2)+"px").css("top",b.toFixed(2)+"px").css("width",(e-2*a.graphics.svg.rectMargin).toFixed(2)).css("height", g.toFixed(2)).css("line-height",g.toFixed(2)+"px");var k=a.intervalText.find(".intervalIcon").css("max-height",g.toFixed(2)-5);k.load(function(){a.intervalText.css("padding-left",k.width()+5)});a.intervalText.bind("mouseover touchStart",function(){f(this).siblings(".toFront").removeClass("toFront");f(this).addClass("toFront")});a.intervalText.bind("mouseout",function(){f(this).removeClass("toFront")})}},s={type:"event",init:function(a,c,b,d){this.graphics=d;this.laneIndex=c;this.data=f.extend({}, f.fn.vacuumGantt.eventOptions,b);"undefined"==typeof this.data.date&&this.graphics.errorMsg("ERR_BAD_EVENT_TYPE",b);"string"===typeof b.date&&""!=b.date&&(this.date=new Date(b.date));this.date instanceof Date||this.graphics.errorMsg("ERR_DATE_FMT",this.data.date);this.minMaxDate(a,this.date)},render:function(){var a=this.data.classes.join(" ");this.eventText=f("<div/>",{"class":"eventText "+a,html:this.data.label});"string"===typeof this.data.icon&&""!=this.data.icon&&(a=f("<img />",{src:this.data.icon, "class":"eventIcon"}),this.eventText.prepend(a));this.graphics.attachTooltip(this.eventText,this.data.tooltip);this.graphics.svg.wrapper.append(this.eventText)},minMaxDate:function(a,c){if(null==a.minDate||a.minDate>c)a.minDate=c;if(null==a.maxDate||a.maxDate<c)a.maxDate=c},resize:function(){var a=this,c=Math.abs(a.date-a.graphics.svg.minValue),b=parseInt(a.graphics.labels.laneHeight)*a.laneIndex+a.graphics.svg.rectMargin-1,d=parseInt(a.graphics.labels.laneHeight)-2*a.graphics.svg.rectMargin+1,c= a.graphics.svg.scale(c);a.eventText.css("left",parseInt(c.toFixed(2))+4+"px").css("top",b.toFixed(2)+"px").css("height",d).css("line-height",d+"px");var e=a.eventText.children(".eventIcon").css("max-height",d);e.load(function(){a.eventText.css("padding-left",e.width()+5)});a.eventText.load(function(){c.toFixed(2)+parseInt(f(this).width)>a.svg.width&&(a.svg.eventOverflow=Math.abs(c.toFixed(2)+parseInt(f(this).width)-a.svg.width),a.svg.eventOverflow=0,a.svg.elem.attr("width",a.svg.width+a.svg.eventOverflow))}); a.eventText.bind("mouseover touchStart",function(){f(this).siblings(".toFront").removeClass("toFront");f(this).addClass("toFront")});a.eventText.bind("mouseout",function(){f(this).removeClass("toFront")})}};f.fn.vacuumGantt=function(a){this.each(function(c,b){var d=Object.create(r);d.init(a,b);d.resize();f(m).resize(function(){d.resize()})})};f.fn.vacuumGantt.options={settings:{boundaries:{startDate:null,endDate:null},viewport:{width:2629743830,position:0},labelsWidth:"130px",laneHeight:"30px",grid:{color:"#000", timelines:[]}},onLaneClick:null};f.fn.vacuumGantt.laneOptions={id:null,description:"",icon:"",classes:"",items:[]};f.fn.vacuumGantt.intervalOptions={icon:"",classes:[],label:""};f.fn.vacuumGantt.eventOptions={icon:"",classes:[],label:""}})(jQuery,window);